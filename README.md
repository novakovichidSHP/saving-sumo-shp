# Обработка .sumo-файлов для Sumo3D

## Возможности
- Конвертация .sumo (архив с data.txt) в обычный JSON
- Исправление типов геометрии (BoxBufferGeometry → BoxGeometry и др.)
- Удаление лишних полей и ссылок на sumo.app/api/auth/check
- Корректная обработка встроенных base64-изображений (jpeg/jpg → png, только в полной версии)
- Сборка обратно в .sumo-архив с сохранением всех ресурсов
- Пакетная и одиночная обработка файлов через GUI

## Скрипты

### 1. Полная версия (с Pillow)
- **Файл:** `sumo_fix_pipeline.py`
- Требует: Python 3.x, библиотеки `pillow`, `tkinter`
- Умеет перекодировать встроенные изображения в PNG для максимальной совместимости с Sumo3D

### 2. Облегчённая версия (без Pillow)
- **Файл:** `sumo_fix_pipeline_no_pillow.py`
- Требует только стандартный Python 3.x и tkinter (обычно есть по умолчанию)
- Не перекодирует изображения, а только проверяет корректность base64-строк
- Рекомендуется для быстрой пакетной обработки, если не требуется перекодирование картинок

## Сборка exe-файла

Для Windows можно собрать самостоятельный exe-файл (не требует Python на целевом ПК):

1. Установите pyinstaller:
   ```
   pip install pyinstaller
   ```
2. Соберите exe (для полной или облегчённой версии):
   - Для полной:
     ```
     pyinstaller --onefile --noconsole sumo_fix_pipeline.py
     ```
   - Для облегчённой:
     ```
     pyinstaller --onefile --noconsole sumo_fix_pipeline_no_pillow.py
     ```
3. Готовый exe появится в папке `dist`.

## Использование
- Запустите скрипт или exe-файл.
- Выберите файл или папку с .sumo-файлами.
- Дождитесь завершения обработки. Результаты будут в той же папке (или в подпапке `fixed`).

## Известные ограничения
- Иногда изображения внутри data.txt могут быть повреждены или не открываться в WebGL
- Нет строгой валидации итогового JSON и изображений
- Нет автоматического теста на валидность итогового файла
- Нет логирования с сохранением отчёта о проблемных файлах/изображениях

## TODO
- Добавить автоматическую валидацию JSON и изображений
- Реализовать логирование ошибок и отчёты
- Улучшить обработку edge-case файлов

---

**Вопросы и предложения — приветствуются!** 